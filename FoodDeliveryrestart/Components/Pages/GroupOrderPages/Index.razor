@page "/grouporders"
@using Microsoft.EntityFrameworkCore
@using Microsoft.AspNetCore.Components.QuickGrid
@using FoodDeliveryrestart.Domain
@using FoodDeliveryrestart.Data
@implements IAsyncDisposable
@inject IDbContextFactory<FoodDeliveryrestartContext> DbFactory

<PageTitle>Group Orders</PageTitle>

<div class="grouporders-page">

    <!-- Header -->
    <div class="go-header">
        <div>
            <h1 class="go-title">Group Orders</h1>
            <p class="go-subtitle">
                Create or join group orders with friends and order together 🍽️
            </p>
        </div>

        <a class="btn-create" href="/grouporders/create">
            + Create Group Order
        </a>
    </div>

    <!-- Table Card -->
    <div class="go-card">
        <QuickGrid Class="go-table" Items="context.GroupOrder">
            <PropertyColumn Title="Code" Property="g => g.GroupCode" />
            <PropertyColumn Title="Created" Property="g => g.CreatedTime" />
            <PropertyColumn Title="Status" Property="g => g.Status" />
            <PropertyColumn Title="Closed" Property="g => g.ClosedTime" />
            <PropertyColumn Title="Mall" Property="g => g.MallId" />

            <TemplateColumn Title="Actions" Context="g">
                <div class="go-actions">
                    <a href="@($"/grouporders/details?id={g.Id}")">View</a>
                    <a href="@($"/grouporders/edit?id={g.Id}")">Edit</a>
                    <a class="danger" href="@($"/grouporders/delete?id={g.Id}")">Delete</a>
                </div>
            </TemplateColumn>
        </QuickGrid>
    </div>

</div>

@code {
    private FoodDeliveryrestartContext context = default!;

    protected override void OnInitialized()
    {
        context = DbFactory.CreateDbContext();
    }

    public async ValueTask DisposeAsync()
        => await context.DisposeAsync();
}
