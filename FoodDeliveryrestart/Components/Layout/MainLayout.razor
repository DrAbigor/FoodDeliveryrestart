@inherits LayoutComponentBase
@inject NavigationManager Nav

<AuthorizeView>
    <Authorized>
        @if (!IsAuthPage())
        {
        <header class="topbar">
            <a class="brand" href="/">
                <span class="brand-mark">
                    <i class="bi bi-shop"></i>
                </span>
                <span class="brand-text">Food Delivery</span>
            </a>
            <nav class="toplinks">
                <a class="toplink @(IsActive("/") ? "active" : "")" href="/">Home</a>
                <a class="toplink @(IsActive("/restaurants") ? "active" : "")" href="/restaurants">Restaurants</a>
                <a class="toplink @(IsActive("/grouporders") ? "active" : "")" href="/grouporders/selectmall">Group Orders</a>
            </nav>
            <div class="topicons">
                <a class="iconbtn" href="/profile" title="Profile">
                    <i class="bi bi-person"></i>
                </a>
                <a class="iconbtn" href="/cart" title="Cart">
                    <i class="bi bi-cart3"></i>
                    <CartBadge />
                </a>
            </div>
        </header>
        }
    </Authorized>
    <NotAuthorized>
        @* Hide header when user is not authenticated *@
    </NotAuthorized>
</AuthorizeView>

<main class="app-main">
    @Body
</main>

@code {
    private bool IsActive(string path)
    {
        var current = Nav.ToBaseRelativePath(Nav.Uri);
        var currentPath = "/" + current.Trim('/');
        if (path == "/") return currentPath == "/";
        return currentPath.StartsWith(path.Trim('/'), StringComparison.OrdinalIgnoreCase);
    }

    private bool IsAuthPage()
    {
        var current = "/" + Nav.ToBaseRelativePath(Nav.Uri).Trim('/');
        return current.Equals("/login", StringComparison.OrdinalIgnoreCase)
            || current.Equals("/register", StringComparison.OrdinalIgnoreCase)
            || current.StartsWith("/auth", StringComparison.OrdinalIgnoreCase);
    }
}